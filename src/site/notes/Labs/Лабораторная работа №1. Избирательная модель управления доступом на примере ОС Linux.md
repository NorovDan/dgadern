---
{"dg-publish":true,"permalink":"/labs/laboratornaya-rabota-1-izbiratelnaya-model-upravleniya-dostupom-na-primere-os-linux/"}
---


---

**ФИО:** 2022-ФГиИБ-ИБ-1б Воронов Даниил Алексеевич 

---


### 1. Создание пользователей

**1.1. Создать 3 новых пользвателя (user1, user2, user3). Создать для них домашние директории и установить shell-оболочку по умолчанию (/bin/sh)**

![Pasted image 20250212003641.png](/img/user/Pasted%20image%2020250212003641.png)
<div style="text-align: center;">
  Рисунок 1 - Создание трех пользователей
</div>

С помощью данных команд создаем пользователей **user1**, **user2**, **user3**. Флагом `-h` задаем домашнюю директорию, а `-s` устанавливаем оболочку. Также устанавливаем пароли для этих пользователей. 

**1.2. Проверить, что пользователи и домашние директории были созданы. Проверить группы, которым принадлежат пользователи.**

![Pasted image 20250212004413.png](/img/user/Pasted%20image%2020250212004413.png)
<div style="text-align: center;">
  Рисунок 2 - Просмотр файла /etc/passwd
</div>

![Pasted image 20250212004451.png](/img/user/Pasted%20image%2020250212004451.png)
<div style="text-align: center;">
  Рисунок 3 - Просмотр файла /etc/group
</div>

Для только что созданных пользователей были установлены группы с GID, где для **user1** был присвоен **1000**, **user2** - **1001**, **user3** - **1002**

**1.3. Просмотреть файл /etc/shadow, объяснить его структуру.**

![Pasted image 20250212004820.png](/img/user/Pasted%20image%2020250212004820.png)
<div style="text-align: center;">
  Рисунок 4 - Просмотр файла /etc/shadow
</div>

В данном файле хранится информация о пользователяхm где: 
1. Имя пользователя 
2.  Хешированный пароль
3. Число дней прошедших с 1 января 1970 года
4. Минимальное количество дней между изменениями пароля
5. Максимальное количество дней, после которого пароль должен быть изменен
6. Количество дней до истечения срока действия пароля, когда пользователь будет предупрежден
7. Количество дней после истечения срока действия пароля, после которых аккаунт будет отключен
8. Дата истечения срока действия аккаунта

Здесь используется хешированный пароль с помощью алгоритмы **SHA-512**, так как он хешированный парольный начинается с префикса `$6`

![Pasted image 20250212010125.png](/img/user/Pasted%20image%2020250212010125.png)
<div style="text-align: center;">
  Рисунок 5 - Изменение пароля для user1 и просмотр файла /etc/shadow
</div>

После смены пароля изменился и хешированный пароль 

**1.4. Создайте новую группу, которая будет включать двух из трех пользователей (user1, user2). Удалите группы тех пользователей, которых вы объединили (user1, user2).**

![Pasted image 20250212012804.png](/img/user/Pasted%20image%2020250212012804.png)
<div style="text-align: center;">
  Рисунок 6 - Создание группы work и добавление в нее user1, user2
</div>

![Pasted image 20250212013117.png](/img/user/Pasted%20image%2020250212013117.png)
<div style="text-align: center;">
  Рисунок 7 - Через cat /etc/group проверяем, что пользователи есть в группе
</div>

Через `nano etc/passwd` меняем GID у пользователей **user1** и **user2** на GID созданной группы - **1003** 

![Pasted image 20250212013455.png](/img/user/Pasted%20image%2020250212013455.png)
<div style="text-align: center;">
  Рисунок 8 - Удаление группы пользователей
</div>

Пытаемся удалить группу work, но не можем этого сделать так как она является основной для user1
#### 2. Разрешения

**2.1. Авторизуйтесь под первым пользователем (user1). Создайте файл в домашней директории пользователя, проверьте разрешения по умолчанию.**

Через passwd user1 заходим в пользователя:

![Pasted image 20250212013921.png](/img/user/Pasted%20image%2020250212013921.png)
<div style="text-align: center;">
  Рисунок 9 - Заходим под user1
</div>

![Pasted image 20250212014004.png](/img/user/Pasted%20image%2020250212014004.png)
<div style="text-align: center;">
  Рисунок 10 - Создаем файл work.txt и проверяем разрешение 
</div>

**rw-** обозначает, что user1 может читать и писать в файле, `r--` - пользователи той же группы, что и user1, могут только читать файл, `r--` - остальные пользователи могут только читать

**2.2. Измените права таким образом, чтобы пользователь той же группы (user2) мог редактировать файл, а отдельный (user3) - не мог видеть и редактировать.**

![Pasted image 20250212200741.png](/img/user/Pasted%20image%2020250212200741.png)
<div style="text-align: center;">
  Рисунок 11 - Изменение прав доступа
</div>

`g+rw` - добавление возможности редактировать файл для пользователей той же группы, `o-rw` - означает, что остальные пользователи не могут читать и редактировать файл

**2.3. Измените права на файл таким образом, чтобы владелец (user1) и отдельный пользователь (user3) могли читать и редактировать файл, а второй пользователь (user2) - нет.**

![Pasted image 20250212201149.png](/img/user/Pasted%20image%2020250212201149.png)
<div style="text-align: center;">
  Рисунок 12 - Изменение прав доступа
</div>

`g-rw` - пользователи той же группы не могут читать и редактировать файл, `o+rw` - остальные могут

**2.4. Создайте директорию, поместите в нее несколько файлов. Повторите шаг 2.2 и 2.3 для директории и файлов внутри нее.**

![Pasted image 20250212205338.png](/img/user/Pasted%20image%2020250212205338.png)
<div style="text-align: center;">
  Рисунок 13 - Создание директории и файлов и повторение действий пункта 2.2
</div>

![Pasted image 20250212205426.png](/img/user/Pasted%20image%2020250212205426.png)
<div style="text-align: center;">
  Рисунок 14 - Повторение действий пункта 2.3
</div>


**2.5. Создайте скрипт на ЯП Python с расширением .py. Задайте ему шебанг. Попробуйте запустить скрипт самостоятельно, без вызова интерпретатора.**

![Pasted image 20250212205613.png](/img/user/Pasted%20image%2020250212205613.png)
<div style="text-align: center;">
  Рисунок 15 - Файл mat.py
</div>

Изначально в **Linux Alpine** нету **python**, так что его пришлось устанавливать через основного пользователя  с помощью команды `apk add python3`

![Pasted image 20250212205843.png](/img/user/Pasted%20image%2020250212205843.png)
<div style="text-align: center;">
  Рисунок 16 - Выполнение файла mat.py
</div>

#### 3. Специальные разрешения

**3.1. Что делает следующая команда?**

```
chmod 4762 filename
```

Эта команда устанавливает специальные разрешения для какого-то файла `filename` :  
  
`4`: устанавливает бит SUID (при запуске файла с правами владельца)
  
`7`: владельцу разрешены все права (чтение, запись, выполнение).
  
`6`: группе разрешены чтение и запись 
  
`2`: остальным разрешено выполнение

**3.2. Зайдите под первым пользователем (user1) и создайте директорию (например, dir1), внутрь поместите несколько исполняемых скриптов с расщирением .py. Для этой директории рекурсивно установите UID, GID и Sticky Bit. Дайте скриптам права на исполнение.**

![Pasted image 20250213000150.png](/img/user/Pasted%20image%2020250213000150.png)
<div style="text-align: center;">
  Рисунок 17 - Создание директории dir1 и рекурсивная установка UID, GID и Sticky Bit
</div>

Теперь владелец обладает возможностью читать, изменять и выполнять файлы. При этом вместо `x` указан `s`. Это значит, что **SETUID**, позволяет при исполнении файла использовать **UID** владельца. Gри этом **Sticky Bit** отвечает за то, что только владельцы могут удалять собственные файлы директории

**3.3. Удалите права на исполнения для всего в домашней директории.**

![Pasted image 20250213001214.png](/img/user/Pasted%20image%2020250213001214.png)
<div style="text-align: center;">
  Рисунок 18 - Удаление прав для домашней директории
</div>

Видно, что `s` изменился на `S`, a `t` на `T`

**3.4. Установите для созданной директории (dir1) права таким образом, чтобы пользователи из других групп могли осуществлять навигацию и читать файлы внутри.**

![Pasted image 20250213001718.png](/img/user/Pasted%20image%2020250213001718.png)
<div style="text-align: center;">
  Рисунок 19 - Установка прав для директории dir1
</div>

Теперь остальные пользователи могут читать и изменять файл

![Pasted image 20250213002351.png](/img/user/Pasted%20image%2020250213002351.png)
<div style="text-align: center;">
  Рисунок 20 - Изменение владельца директории на user3
</div>

Произошло изменение с группы 1000 на 1002, в которой есть только user3

**3.5. Авторизуйтесь в системе под вторым пользователем (user2) и создайте директорию {user2}_share. Установите разрешения таким образом, чтобы второй пользователь мог делиться файлами с первым (user1) и отдельным (user3)**.

![Pasted image 20250213002743.png](/img/user/Pasted%20image%2020250213002743.png)
<div style="text-align: center;">
  Рисунок 20 - Создание директории user2_share и установка разрешений
</div>

`chmod -R 1777` позволяет пользователям работать только с собственными файлами и директориями

**3.6. Создайте файл sensetive_data от имени второго пользователя (user2) и запишите в него какую-либо текстовую информацию. Уберите разрешения для группы и всех остальных.**

![Pasted image 20250224234954.png](/img/user/Pasted%20image%2020250224234954.png)
<div style="text-align: center;">
  Рисунок 21 - Создание файла sensetive_data
</div>

![Pasted image 20250224235042.png](/img/user/Pasted%20image%2020250224235042.png)
<div style="text-align: center;">
  Рисунок 22 - Содержание файла sensetive_data
</div>

![Pasted image 20250224235107.png](/img/user/Pasted%20image%2020250224235107.png)
<div style="text-align: center;">
  Рисунок 23 - Ограничение файла sensetive_data
</div>

![Pasted image 20250224235245.png](/img/user/Pasted%20image%2020250224235245.png)
<div style="text-align: center;">
  Рисунок 24 - Попытка посмотреть файл через user2 через cat
</div>

![Pasted image 20250224235326.png](/img/user/Pasted%20image%2020250224235326.png)<div style="text-align: center;">
  Рисунок 25 - Попытка посмотреть файл через user2 через vi
</div>

![Pasted image 20250224235413.png](/img/user/Pasted%20image%2020250224235413.png)
<div style="text-align: center;">
  Рисунок 26 - Установка SUID bit на busybox
</div>

BusyBox — набор UNIX-утилит командной строки, используемый в качестве основного интерфейса во встраиваемых операционных системах.

![Pasted image 20250224235640.png](/img/user/Pasted%20image%2020250224235640.png)
<div style="text-align: center;">
  Рисунок 27 - Повторная попытка посмотреть файл через user2
</div>

Если `busybox` настроен с SUID битом, то он будет выполняться с правами владельца (обычно root). Однако это не изменит разрешения на файл `sensitive_data`. Таким образом, даже если `busybox` выполняется с правами root, он не сможет прочитать файл `sensitive_data`, так как права доступа к файлу остаются ограниченными для user3. SUID позволяет пользователям запускать программы с привилегиями владельца, но это не изменяет разрешения файлов, к которым эти программы пытаются получить доступ. В данном случае, даже с использованием SUID, user3 не сможет прочитать файл `sensitive_data`, так как у него нет соответствующих разрешений.